
# Example

Here we compute the energy current from one snapshot of SiO2 extracted from a CPMD simulation.

First you need to compile the scripts with `make`. Then copy-paste or execute `run_example.sh` to run the example (edit the paths according to your installation).

- Input parameters are contained in the file `tabella`. These are read by the `create_pw_input2` and `create_hz_input` scripts that generate 4 input files.

- To calculate the energy current, for each snapshot at time t, we need to do run in this order:

 1. a **PW-SCF calculation** of the snapshot at time t. Wavefunctions will be saved in folder `a_blocco`.

 2. a **PW-SCF calculation** of a snapshot at time t + dt, where dt is a small step (0.5). This will be used to compute derivatives via finite differences. This configuration is generated by the `create_pw_input2` script by simply interpolating the equations of motion using the velocities (x = x0 + dt * v). Wavefunctions will be saved in folder `b_blocco`.

 3. a **HARTREE-init** calculation, that computes some ionic/pseudo components of the energy current that only depend on the species considered (you can run this once and use the resulting *thermal* files for all the MD steps). Thermal files saved in folder `_thermo`.

 4. a **HARTREE-run** calculation, that computes all the components of the energy current at time t. It uses the wavefunctions `a_blocco`, `b_blocco`, and `_thermo` files. Results saved in `current_hz`.

- The total current is computed by the script `read_hartree_currents.py` and appended to `current_hz`.


- A more automated workmanager that parallelizes the calculation of the current of many snapshots can be found in the `qe-thermalcurrents-workmanager` repository.

