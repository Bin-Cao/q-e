input_description -distribution {Quantum Espresso} -package KC_WANN -program kc_screen.x {

    toc {}

    intro {
	@b {Input data format:} { } = optional, [ ] = it depends, # = comment

	@b {Structure of the input data:}
	===============================================================================

	@b &CONTROL
	   ...
	@b /

        @b &WANNIER
           ...
        @b /

        @b &SCREEN
           ...
        @b /

    }

    namelist CONTROL {

        var prefix -type CHARACTER {
            default { 'pwscf' }
            info {
                Prepended to input/output filenames; must be the same 
                used in the previous PW calculations.
            }
        }

        var outdir -type CHARACTER {
            default {
                @br current directory ('./')
            }
            info {
		Directory containing input, output, and scratch files; 
                must be the same as specified in the calculation of 
                previous PW calculation.
            }
        }


        var kc_iverbosity -type INTEGER {
            default { 1 }
            info {
                = 0 : minimal output
                = 1 : as above + performs additional checks.
                > 1 : as above + additional infos on all the steps.
            }
        }

        var kc_at_ks  -type LOGICAL {
            default { .TRUE. }
            info {
             If true the KS canonical orbitals are used instead of Wannier;
             functions. It make sense for isolated system only.
            }
        }


        var read_unitary_matrix  -type LOGICAL {
            default { .FALSE. }
            info {
             If true read the Unitary matrix written by Wannier90.
             Implicitely means a previous wannier90 calculation was
             performed and a KC calculation will be performed starting 
	     from MLWF. Resuires 'write_hr = .true.' in wannier90.
            }
        }

        var spread_check  -type LOGICAL {
            default { .FALSE. }
            info {
             NOT IMPLMENTED YET. Check on the spread of the Wannier functions
             to reduce the number of independent Linear Response calculations.
            }
        }

        var spread_thr  -type REAL {
            default { 0.001 Ry }
            info {
             NOT IMPLMENTED YET. Two or more Wannier functions are considered
             identical if their spread (self-hartree) differ by less than spread_thr.
	     Requires @ref spread_check = .true.
            }
        }

       var homo_only  -type LOGICAL {
            default { FALSE }
            info {
            If @ref kc_at_ks = .TRUE. only the screening paramenter for the HOMO is
            calculated. Mainly for a perturbative calculation of the first Ionization
            Potential in isolated systems.
            }
        }

       var l_vcut  -type LOGICAL {
            default { FALSE }
            info {
            If .TRUE. the Gygi-Baldereschi scheme is used to deal with
            the q->0 divergence of the Coulomb integral (bare and screened).
            Improves the convergence wrt k/q-point sampling.
            Requires to correctly set @ref eps_inf for the calculation of 
            the screened interaction. 
         
            Use it only for periodic system. 
            For isoleted system use @ref assume_isolated, instead.
            }
        }

       var assume_isolated -type CHARACTER {
            default { 'none' }
            options {
                info {
                    Used to perform calculation assuming the system to be
                    isolated (a molecule or a cluster in a 3D supercell).

                    Currently available choices:
                }

                opt -val 'none' {(default): regular periodic calculation w/o any correction. }

                opt -val {'martyna-tuckerman', 'm-t', 'mt'} {
                    Martyna-Tuckerman correction
                    to both total energy and scf potential. Adapted from:
                    G.J. Martyna, and M.E. Tuckerman,
                    "A reciprocal space based method for treating long
                    range interactions in ab-initio and force-field-based
                    calculation in clusters", J. Chem. Phys. 110, 2810 (1999),
                    doi:10.1063/1.477923.
                }


            }
        }



        var spin_component -type INTEGER {
            default { 1 }
            info {
             Which spin channel to calculate (only collinear calculation). 
             1 = spin up channel
             2 = spin down channel
             It has to be consistent with the previous Wannier90 
             calculation (see 'spin' keyword in Wann90 documentation)                
            }
        }

}  


    namelist WANNIER {

	var seedname -type CHARACTER {
	   default { wann }
           info {
           The seedname of the previous Wannier90 calculation for occupied states.
           NOTA BENE: the code implicitely assumed that the seedname for empty 
           state is the same as that for occupied state with "_emp" appended. 
           Keep this in mind when set up the wannier90 inputs. 

           For example:
           wann.win         is the wannier90 input file for the occupied states.
           wann_emp.win     is the wannier90 input file for the empty states.
           }
        }

	var num_wann_occ -type INTEGER {
	   default { 0 }
           info {
           The number of wannier function for the occupied manifold.
           It has to coincide with the number of occupied KS orbitals.
           The whole KS manifold has to be wannierised (no 'exclude_band' 
           option for occupied state, at the moment).
           }
	}

	var num_wann_emp -type INTEGER {
	   default { 0 }
           info {
           The number of wannier function for the empty manifold. 
           It has to coincide with the number of empty wannier function
           from the previous wannier90 calculation
           }
	}

	var have_empty -type LOGICAL {
	    default { FALSE }
	    info {
	    If true empty state are computed. Require a previous wannier90
            calculation for the empty manifold. The code search for the 
	    unitary matrices in the wannier90 file seedname_emp_u.mat
	    }
	}
	
	var has_disentangle -type LOGICAL {
	    default { FALSE }
	    info {
 	    Specify if a disentangle unitary matrix needs to be read. Requires
	    a consisten calcuation from the previous wannier90 run.
	    }
	}

}


    namelist SCREEN {

        vargroup -type INTEGER {
            var mp1
            var mp2
            var mp3
            default { -1,-1,-1 }
            info {
            Parameters of the Monkhorst-Pack grid (no offset).
            Same meaning as for nk1, nk2, nk3 in the input of pw.x.
            It has to coincide with the regular mesh used for the 
  	    wannier90 calculation. 
            }
        }

	var lrpa -type LOGICAL {
	   default { .FALSE. } 
	   info {
	   If .true. the response function is computed neglecting xc 
           effects both in the kernel and in the response function (RPA).
	   }
	}

        var niter_ph -type INTEGER { 
            default { maxter=100 }
            info {
                Maximum number of iterations in a scf step. If you want
                more than 100, edit variable "maxter" in PH/phcom.f90
            }
        }
 
        var nmix_ph   -type INTEGER { 
            default { 4 }
            info { Number of iterations used in potential mixing. }
        }

        var tr2_ph   -type REAL { 
            default { 1e-14 }
            info     { Threshold for self-consistency. }
        }

	var i_orb -type INTEGER {
	default { -1 } 
	info {
             Perform the screening calculation for a particular orbital.
             If i_orb = -1 (default) all the orbitals are computed.
             Assumes values between 1 and the total number of wannier 
	     functions. 
	     }
	}
	var eps_inf -type REAL {
	default { 1.d0 } 
	info {
	     The macroscopic dielectric constant. Needed for the Gygi-Baldereschi 
             scheme if @ref l_vcut = .TRUE. 
             Typically from exp or from a ph.x calculation.
             NOTA BENE: This would be equivalent to a Makov-Payne correction.
                        it is perfectly fine for cubic systems. Not so for 
                        anisotropic dielectric matrices. 
	     }
	}

}

}
